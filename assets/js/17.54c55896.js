(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{382:function(t,e,o){"use strict";o.r(e);var a=o(14),s=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h3",{attrs:{id:"支持数据库全局查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支持数据库全局查询"}},[t._v("#")]),t._v(" 支持数据库全局查询")]),t._v(" "),e("ol",[e("li",[t._v("在每个数据应用logic中添加"),e("code",[t._v("Model(ctx context.Context)")]),t._v("方法,代码示例如下:")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("//见文件 modules\\system\\logic\\system\\setting_config.go\nfunc (s *sSettingConfig) Model(ctx context.Context) *gdb.Model {\n\treturn dao.SettingConfig.Ctx(ctx).Hook(hook.Bind()).Cache(orm.SetCacheOption(ctx))\n}\n")])])]),e("p",[t._v("该方法返回一个gdb.Model对象，该对象添加cache"),e("code",[t._v("Cache(orm.SetCacheOption(ctx))")]),t._v("支持全局查询缓存，且Hook绑定了modules/system/pkg/hook/cache_evict.go钩子，一但数据表有插入，更新，删除操作可以批量清除相关数据表缓存。")]),t._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[t._v("使用Model(ctx context.Context)方法的查询，默认都支持缓存，且缓存时间默认24小时，可以修改"),e("code",[t._v("orm.SetCacheOption(ctx context.Context, duration ...time.Duration)")]),t._v("的参数，自定义缓存时间;例子如下:")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("var settingConfigGroup *entity.SettingConfigGroup\nerr = service.SettingConfigGroup().Model(ctx).Where(dao.SettingConfigGroup.Columns().Code, gkey).Scan(&settingConfigGroup)\n// 除了第一次，后续查询都支持缓存，且缓存时间默认24小时\n")])])]),e("blockquote",[e("p",[t._v("如果不需要缓存，可以直接调用"),e("code",[t._v("dao.SettingConfig.Ctx(ctx)")]),t._v("方法，例如：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("var settingConfigGroup *entity.SettingConfigGroup\nerr = service.SettingConfigGroup().Ctx(ctx).Where(dao.SettingConfigGroup.Columns().Code, gkey).Scan(&settingConfigGroup)\n")])])])]),t._v(" "),e("p",[t._v("// 不支持缓存")]),t._v(" "),e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code")])])]),t._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[t._v("改功能可以关闭，在config.yaml中配置设为false")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("settings:\n  enableGlobalDbCache: true # 是否开启全局数据库缓存，默认false\n")])])]),e("h3",{attrs:{id:"支持带tag的缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支持带tag的缓存"}},[t._v("#")]),t._v(" 支持带tag的缓存")]),t._v(" "),e("ol",[e("li",[t._v("相关方法见 "),e("code",[t._v("modules\\system\\pkg\\cache\\utils.go")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);